{"version":3,"sources":["AppStart.js"],"names":["urlParse","params","window","location","name","value","str","href","num","indexOf","substr","arr","split","i","length","substring","initMgr","cc","vv","UserMgr","require","userMgr","ReplayMgr","replayMgr","http","global","net","GameNetMgr","gameNetMgr","initHandlers","AnysdkMgr","anysdkMgr","init","VoiceMgr","voiceMgr","AudioMgr","audioMgr","Utils","utils","args","Class","extends","Component","properties","label","default","type","Label","loadingProgess","onLoad","setFitSreenMode","_mainScene","showSplash","getServerInfo","bind","onBtnDownloadClicked","sys","openURL","SI","appweb","callback","self","SHOW_TIME","FADE_TIME","_splash","find","os","OS_IOS","isNative","active","getComponent","Sprite","spriteFrame","t","Date","now","fn","dt","setTimeout","op","opacity","onGetVersion","ret","url","raw","loader","load","err","data","VERSION","version","console","log","director","loadScene","xhr","complete","fnRequest","string","sendRequest","abort","content"],"mappings":"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","file":"AppStart.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["function urlParse(){\r\n    var params = {};\r\n    if(window.location == null){\r\n        return params;\r\n    }\r\n    var name,value; \r\n    var str=window.location.href; //取得整个地址栏\r\n    var num=str.indexOf(\"?\") \r\n    str=str.substr(num+1); //取得所有参数   stringvar.substr(start [, length ]\r\n\r\n    var arr=str.split(\"&\"); //各个参数放到数组里\r\n    for(var i=0;i < arr.length;i++){ \r\n        num=arr[i].indexOf(\"=\"); \r\n        if(num>0){ \r\n            name=arr[i].substring(0,num);\r\n            value=arr[i].substr(num+1);\r\n            params[name]=value;\r\n        } \r\n    }\r\n    return params;\r\n}\r\n\r\nfunction initMgr(){\r\n    cc.vv = {};\r\n    var UserMgr = require(\"UserMgr\");\r\n    cc.vv.userMgr = new UserMgr();\r\n    \r\n    var ReplayMgr = require(\"ReplayMgr\");\r\n    cc.vv.replayMgr = new ReplayMgr();\r\n    \r\n    cc.vv.http = require(\"HTTP\");\r\n    cc.vv.global = require(\"Global\");\r\n    cc.vv.net = require(\"Net\");\r\n    \r\n    var GameNetMgr = require(\"GameNetMgr\");\r\n    cc.vv.gameNetMgr = new GameNetMgr();\r\n    cc.vv.gameNetMgr.initHandlers();\r\n    \r\n    var AnysdkMgr = require(\"AnysdkMgr\");\r\n    cc.vv.anysdkMgr = new AnysdkMgr();\r\n    cc.vv.anysdkMgr.init();\r\n    \r\n    var VoiceMgr = require(\"VoiceMgr\");\r\n    cc.vv.voiceMgr = new VoiceMgr();\r\n    cc.vv.voiceMgr.init();\r\n    \r\n    var AudioMgr = require(\"AudioMgr\");\r\n    cc.vv.audioMgr = new AudioMgr();\r\n    cc.vv.audioMgr.init();\r\n    \r\n    var Utils = require(\"Utils\");\r\n    cc.vv.utils = new Utils();\r\n    \r\n    //var MJUtil = require(\"MJUtil\");\r\n    //cc.vv.mjutil = new MJUtil();\r\n    \r\n    cc.args = urlParse();\r\n}\r\n    \r\n\r\n    \r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        label: {\r\n            default: null,\r\n            type:cc.Label\r\n        },\r\n\r\n        loadingProgess:cc.Label,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        initMgr();\r\n        cc.vv.utils.setFitSreenMode();\r\n        this._mainScene = 'loading';\r\n        this.showSplash(function(){\r\n            this.getServerInfo();\r\n        }.bind(this));\r\n    },\r\n\r\n    onBtnDownloadClicked:function(){\r\n        cc.sys.openURL(cc.vv.SI.appweb);\r\n    },\r\n    \r\n    showSplash:function(callback){\r\n        var self = this;\r\n        var SHOW_TIME = 3000;\r\n        var FADE_TIME = 500;\r\n        this._splash = cc.find(\"Canvas/splash\");\r\n        // cc.sys.os获取操作系统  cc.sys.OS_IOS表示IOS \r\n        // cc.sys.isNative判断是否属于非web浏览器环境运行\r\n        if(true || cc.sys.os != cc.sys.OS_IOS || !cc.sys.isNative){\r\n            this._splash.active = true;\r\n            if(this._splash.getComponent(cc.Sprite).spriteFrame == null){\r\n                callback();\r\n                return;\r\n            }\r\n\r\n            // js实现淡入淡出动画\r\n            var t = Date.now();\r\n            var fn = function(){\r\n                var dt = Date.now() - t;\r\n                if(dt < SHOW_TIME){ // SHOW_TIME延迟动画时长\r\n                    setTimeout(fn,33);\r\n                }\r\n                else {\r\n                    // FADE_TIME执行动画时长\r\n                    var op = (1 - ((dt - SHOW_TIME) / FADE_TIME)) * 255;\r\n                    if(op < 0){\r\n                        self._splash.opacity = 0;\r\n                        callback(); \r\n                    }\r\n                    else{\r\n                        self._splash.opacity = op;\r\n                        setTimeout(fn,33);   \r\n                    }\r\n                }\r\n            };\r\n            setTimeout(fn,33);\r\n        }\r\n        else{\r\n            this._splash.active = false;\r\n            callback();\r\n        }\r\n    },\r\n    \r\n    getServerInfo:function(){\r\n        var self = this;\r\n        var onGetVersion = function(ret){\r\n            cc.vv.SI = ret; // 存储服务器返回的数据\r\n\r\n            // 非web端需判断版本号\r\n            if(cc.sys.isNative){\r\n                var url = cc.url.raw('resources/ver/cv.txt'); // 获取版本号文件路径\r\n                cc.loader.load(url,function(err,data){\r\n                    cc.VERSION = data; // 拿到文件内容所返回的版本号\r\n                    if(ret.version == null){\r\n                        console.log(\"error.\");\r\n                    }\r\n                    else{\r\n                        // 判断版本号是否一致\r\n                        if(cc.vv.SI.version != cc.VERSION){\r\n                            cc.find(\"Canvas/alert\").active = true;\r\n                        }\r\n                        else{\r\n                            cc.director.loadScene(self._mainScene);\r\n                        }\r\n                    }\r\n                }.bind(this));\r\n            }\r\n            else{\r\n                cc.director.loadScene(self._mainScene);\r\n            }\r\n        };\r\n        \r\n        var xhr = null;\r\n        var complete = false;\r\n        var fnRequest = function(){\r\n            self.loadingProgess.string = \"正在连接服务器\";\r\n            xhr = cc.vv.http.sendRequest(\"/get_serverinfo\",null,function(ret){\r\n                xhr = null;\r\n                complete = true;\r\n                onGetVersion(ret);\r\n            });\r\n            setTimeout(fn,5000);            \r\n        }\r\n        \r\n        var fn = function(){\r\n            if(!complete){\r\n                if(xhr){\r\n                    xhr.abort();\r\n                    self.loadingProgess.string = \"连接失败，即将重试\";\r\n                    setTimeout(function(){\r\n                        fnRequest();\r\n                    },5000);\r\n                }\r\n                else{\r\n                    fnRequest();\r\n                }\r\n            }\r\n        };\r\n        fn();\r\n    },\r\n    log:function(content){\r\n        this.label.string += content + '\\n';\r\n    },\r\n});\r\n"]}