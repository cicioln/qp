{"version":3,"sources":["Folds.js"],"names":["cc","Class","extends","Component","properties","_folds","onLoad","vv","initView","initEventHandler","initAllFolds","game","node","getChildByName","sides","i","length","sideName","sideRoot","folds","foldRoot","j","children","n","active","sprite","getComponent","Sprite","spriteFrame","push","hideAllFolds","k","f","self","on","data","initFolds","seats","gameNetMgr","seatData","localIndex","getLocalIndex","seatindex","pre","mahjongmgr","getFoldPre","side","getSide","foldsSprites","index","setSpriteFrameByMJID","mjid","getSpriteFrameByMJID"],"mappings":"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","file":"Folds.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _folds:null,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(cc.vv == null){\r\n            return;\r\n        }\r\n        \r\n        this.initView();\r\n        this.initEventHandler();\r\n        \r\n        this.initAllFolds();\r\n    },\r\n    \r\n    initView:function(){\r\n        this._folds = {};\r\n        var game = this.node.getChildByName(\"game\");\r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        for(var i = 0; i < sides.length; ++i){\r\n            var sideName = sides[i];\r\n            var sideRoot = game.getChildByName(sideName);\r\n            var folds = [];\r\n            var foldRoot = sideRoot.getChildByName(\"folds\");\r\n            for(var j = 0; j < foldRoot.children.length; ++j){\r\n                var n = foldRoot.children[j];\r\n                n.active = false;\r\n                var sprite = n.getComponent(cc.Sprite); \r\n                sprite.spriteFrame = null;\r\n                folds.push(sprite);            \r\n            }\r\n            this._folds[sideName] = folds; \r\n        }\r\n        \r\n        this.hideAllFolds();\r\n    },\r\n    \r\n    hideAllFolds:function(){\r\n        for(var k in this._folds){\r\n            var f = this._folds[i];\r\n            for(var i in f){\r\n                f[i].node.active = false;\r\n            }\r\n        }\r\n    },\r\n    \r\n    initEventHandler:function(){\r\n        var self = this;\r\n        this.node.on('game_begin',function(data){\r\n            self.initAllFolds();\r\n        });  \r\n        \r\n        this.node.on('game_sync',function(data){\r\n            self.initAllFolds();\r\n        });\r\n        \r\n        this.node.on('game_chupai_notify',function(data){\r\n            self.initFolds(data);\r\n        });\r\n        \r\n        this.node.on('guo_notify',function(data){\r\n            self.initFolds(data);\r\n        });\r\n    },\r\n    \r\n    initAllFolds:function(){\r\n        var seats = cc.vv.gameNetMgr.seats;\r\n        for(var i in seats){\r\n            this.initFolds(seats[i]);\r\n        }\r\n    },\r\n    \r\n    initFolds:function(seatData){\r\n        var folds = seatData.folds;\r\n        if(folds == null){\r\n            return;\r\n        }\r\n        var localIndex = cc.vv.gameNetMgr.getLocalIndex(seatData.seatindex);\r\n        var pre = cc.vv.mahjongmgr.getFoldPre(localIndex);\r\n        var side = cc.vv.mahjongmgr.getSide(localIndex);\r\n        \r\n        var foldsSprites = this._folds[side];\r\n        for(var i = 0; i < foldsSprites.length; ++i){\r\n            var index = i;\r\n            if(side == \"right\" || side == \"up\"){\r\n                index = foldsSprites.length - i - 1;\r\n            }\r\n            var sprite = foldsSprites[index];\r\n            sprite.node.active = true;\r\n            this.setSpriteFrameByMJID(pre,sprite,folds[i]);\r\n        }\r\n        for(var i = folds.length; i < foldsSprites.length; ++i){\r\n            var index = i;\r\n            if(side == \"right\" || side == \"up\"){\r\n                index = foldsSprites.length - i - 1;\r\n            }\r\n            var sprite = foldsSprites[index];\r\n            \r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;\r\n        }  \r\n    },\r\n    \r\n    setSpriteFrameByMJID:function(pre,sprite,mjid){\r\n        sprite.spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(pre,mjid);\r\n        sprite.node.active = true;\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}